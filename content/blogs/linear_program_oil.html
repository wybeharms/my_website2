---
categories:
- ""
- ""
date: "2023-03-29"
description: ""
draft: false
image: ""
keywords: ""
slug: linear_program_oil
title: Using Gurobi Solver to Optimze UK's Oil Imports
---



<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>Rising energy prices across Europe has caused inflation to skyrocket, affecting millions of households and students alike. There are a few factors that have contributed to this, with the most significant being ongoing political instability. Energy prices in the UK for example reached an average of $0.34 per kWh in early 2023 - an increase of 60.3% compared to pre-Ukraine war. Considering that crude oil accounts for a third of UK’s energy demand and sourcing energy takes a long time, my study group and I set out to build a small- scale optimization model for the UK government to optimise their oil imports.</p>
<p><img src="../../../../../../../../img/blogs/oil_prices.png" /><!-- --></p>
<p>In 2021 the UK consumed 15.494 billion gallons of oil, 1.9 billion coming from net oil production (the UK extracts oil from the North Sea) and therefore 13.539 billion gallons coming from imports. Given the geopolitical uncertainties and the extraordinary high prices, the UK must focus on diversifying its pool of crude oil suppliers and optimize its purchasing strategy. This project is aimed at setting realistic constraints and assessing the output of the decision variable (how much oil to import from each country).</p>
</div>
<div id="data-sources-and-key-assumptions" class="section level3">
<h3>Data Sources and Key Assumptions</h3>
<p>The data used for the analysis was obtained from the UK Department for Business, Energy &amp; Industrial Strategy. The model built is a simplified version that requires many more inputs such as live prices and trade deals to become more realistic. Nevertheless, a full-scale project version of this can genuinely improve the decision-making process for government officials. This is especially the case for the Department for International Trade who can gain insights from the model to decide on for example negotiation tactics.
For simplicity, we looked at the 6 largest oil exporters to the UK (they account for more than 95% of total imports) and calculated the average production price per gallon and their respective maximum capacity. The numeric calculations are in billions of gallons and in annual terms (2021).</p>
<p><img src="../../../../../../../../img/blogs/capacity_price.png" /><!-- --></p>
</div>
<div id="mixed-integer-linear-programming-model" class="section level3">
<h3>Mixed-Integer Linear Programming Model</h3>
<p><strong>Simple Model</strong></p>
<p>Decision variable: Quantity to import from each country
Constraints:
* Quantity should be less than or equal to the respective capacity of each country
* Sum of quantity must be at least 13.6 billion (the demand for oil) Objective: minimize the total cost (quantity of each country x price)</p>
<p>Python code that runs a function to solver the simple model:</p>
<pre><code>def simple_model(countries, maxProduction, cost, lb_set, ub_set, uk_demand):

m=gp.Model(&quot;oil&quot;)

quantity = m.addVars(countries, name = &quot;quantity&quot;)

for c in countries:
    m.addConstr(quantity[c]&lt;=maxProduction[c], &quot;Maximum_capacity&quot; +c)

for c in countries:
    m.addConstr(quantity[c] &gt;= lb_set[c], &quot;Lower_bound&quot; +c)

for c in countries:
    m.addConstr(quantity[c] &lt;= ub_set[c], &quot;Upper_bound&quot; +c)

m.addConstr(quicksum(quantity[c] for c in countries) &gt;= uk_demand)


m.setObjective(quicksum(quantity[c]*cost[c] for c in countries), GRB.MINIMIZE)

def printSolution(m):
    &#39;&#39;&#39;
    A best practice is to define a function that prints the solution of the model (if it&#39;s not too big to display)
    &#39;&#39;&#39;
    if m.status == GRB.OPTIMAL:
        print(&#39;\nTotal cost: %g&#39; % m.objVal)
        print(&#39;\nQuantity:&#39;)
        for c in countries:
            print(&#39;%s %g&#39; % (c, quantity[c].x))
            # %s means that the first argument printed is a string
            # %g means that the second argument printed is a real number
            # You can print as many variables as you wish
            # E.g., &quot;%s %s %g % (a,b,c)&quot; will print two strings a and b followed by the number c
    else:
        print(&#39;No solution&#39;)

m.optimize()
printSolution(m)
out_quantity = {
    &#39;Norway&#39;: 0,
    &#39;USA&#39;: 0,
    &#39;Libya&#39;:0,
    &#39;Russia&#39;:0,
    &#39;Nigeria&#39;:0,
    &#39;Algeria&#39;:0}
if m.status == GRB.OPTIMAL:
    solution = True
    total_cost = m.objVal
    for c in countries:
        out_quantity[c] = quantity[c].x
else:
    solution = False
    total_cost = 0
    
return solution, total_cost, out_quantity</code></pre>
<p>Running this very basic model we get an output where 100% of imports are allocated to one country, Libya for a total price of $0.272 billion. This is because Libya has the lowest price per gallon and can supply the total demand.</p>
<p><strong>Complex Model</strong></p>
<p>Adding a Piecewise Function:
In the real world, price per gallon does not necessarily have a linear relationship between quantity and price. Rather, transportation costs are crucial in determining the cost of crude oil. Many countries build pipelines for transporting oil, involving significant fixed and operating costs that vary depending on the length and capacity of each pipeline. Others use very oil tankers as their main transportation method of crude oil, which only involves variable transportation costs. We analyzed the price it costs transporting using each version.</p>
<p>Pipelines
There are four countries that import crude oil to the UK via pipelines: <em>Norway, Libya, Russia</em>, and <em>Algeria</em>. We assume that there is a 7 cents per gallon cost to transport oil through a pipeline, regardless of length. Additionally, pipelines have a fixed cost associated with them. This is accounted for by adding $1 cost per gallon for the first x amount of gallons transported through the pipeline. We assume 10% maintenance costs and a 50-year lifespan (depreciation) for pipelines.
Norway: Total yearly fixed cost: 204 million
Libya: Total yearly fixed cost: 792 million
Libya: Total yearly fixed cost: 931 million
Russia: we assume no fixed costs for the UK since this is paid fully by Russia</p>
<p>To make the piecewise function work in the code we added:
* Auxiliary variable that sets an upper bound for each decision variable based on range
* Auxiliary variable that returns a binary number whether Piece A is fully allocated
* Logic that if piece A is less than or equal to the upper bound of a given range, then is piece A full is 0, else it is 1 and Piece B can start being allocated
* Constraint that quantity allocated to each country must be equal to the sum of oil allocated to Piece A and Piece B</p>
<p>Tankers
Next, we proceed to add include <em>Nigeria</em> and <em>the US</em> to our model, which export crude oil to the UK via oil tankers. The cost of chartering a ship can vary widely depending on the length of the voyage, as well as the type of tanker used in transport since this determines total capacity for transport. We identified three common oil tankers:</p>
<p><img src="../../../../../../../../img/blogs/tankers.png" /><!-- --></p>
<p>This is the Python code used to run the Complex Model:</p>
<pre><code>def complex_model(countries, maxProduction, days_ship, cost, lb_set, ub_set, countries_list_pipes, countries_list_ships,  uk_demand, us_or_russia):

print(countries_list_pipes)
print(countries_list_ships)

#Define the piecewise linear cost function
  def printSolution(m):
    &#39;&#39;&#39;
    A best practice is to define a function that prints the solution of the model (if it&#39;s not too big to display)
    &#39;&#39;&#39;
    if m.status == GRB.OPTIMAL:
        print(&#39;\nTotal cost: %g&#39; % m.objVal)
        print(&#39;\nQuantity:&#39;)
        for c in countries:
            print(&#39;%s %g&#39; % (c, quantity[c].x))
            # %s means that the first argument printed is a string
            # %g means that the second argument printed is a real number
            # You can print as many variables as you wish
            # E.g., &quot;%s %s %g % (a,b,c)&quot; will print two strings a and b followed by the number c
    else:
        print(&#39;No solution&#39;)

pieces_list = [&#39;piece A&#39;,&#39;piece B&#39;]
piecewise_price = {(&#39;Norway&#39;, &#39;piece A&#39;): [2.06, 0, 0.4],
                (&#39;Norway&#39;, &#39;piece B&#39;): [1.06, 0.4, 18.4],
                (&#39;Libya&#39;, &#39;piece A&#39;): [1.09 , 0, 0.792],
                (&#39;Libya&#39;, &#39;piece B&#39;): [0.09, 0.792, 14.6],
                (&#39;Russia&#39;, &#39;piece A&#39;): [1.14, 0, 0.558],
                (&#39;Russia&#39;, &#39;piece B&#39;): [0.07, 0.558, 49.1],
                (&#39;Algeria&#39;, &#39;piece A&#39;): [1.33, 0, 0.931],
                (&#39;Algeria&#39;, &#39;piece B&#39;): [0.40, 0.931, 5.07]
                   }

# Now we develop a linear program that optimizes UK&#39;s energy cost under linear piecewise cost models of export countries.

# Create the piecewise model
m2 = gp.Model(&quot;oil_piecewise&quot;)

# Set decision variables
quantity = m2.addVars(countries, name = &quot;quantity&quot;)

#Adding contraints of production of export countries and constraint of UK&#39;s energy demand
for c in countries:
    m2.addConstr(quantity[c]&lt;=maxProduction[c], &quot;Maximum_capacity&quot; +c)
    
for c in countries:
    m2.addConstr(quantity[c] &gt;= lb_set[c], &quot;Lower_bound&quot; +c)

for c in countries:
    m2.addConstr(quantity[c] &lt;= ub_set[c], &quot;Upper_bound&quot; +c)

m2.addConstr(quicksum(quantity[c] for c in countries) &gt;= uk_demand)

# For several of the countries, oil becomes cheaper as more is bought, as such, we must add extra constraints to ensure that piece A of the model is filled before piece B is.

# Add auxiliary variable. This variable sets an upper bound for each decision variable
ub = {(c,p) : (piecewise_price[c,p][2] - piecewise_price[c,p][1]) for c in countries_list_pipes for p in pieces_list}

auxiliary = m2.addVars(countries_list_pipes, pieces_list, lb = 0, ub = ub, name=&quot;auxiliary&quot;)

# to the total allocation for each country
coupling_constraints = m2.addConstrs((
    quicksum(auxiliary[c,p] for p in pieces_list) == quantity[c]
                                     for c in countries_list_pipes),&quot;coupling constraint&quot;)

#add auxiliary variable for is piece A fully allocated
is_piece_A_full = m2.addVars(countries_list_pipes,vtype=GRB.BINARY,name=&quot;is_piece_A_full&quot;)

#add logic for if piece A is less than or equal to the ub-1, then is piece A full is 0, else it is 1
M=10000000000

for c in countries_list_pipes:
    m2.addConstr(auxiliary[c,&#39;piece A&#39;]&lt;=piecewise_price[c,&#39;piece A&#39;][2]-0.01+M*is_piece_A_full[c],&quot;piece_A_full_1&quot;)
    m2.addConstr(auxiliary[c,&#39;piece A&#39;]&gt;=piecewise_price[c,&#39;piece A&#39;][2]-M*(1-is_piece_A_full[c]),&quot;piece_A_full_2&quot;)
    #add logic for if is_piece_A_full is 0, piece B must be equal to 0
    m2.addConstr(auxiliary[c,&#39;piece B&#39;]&lt;=M*is_piece_A_full[c],&quot;piece_A_full_3&quot;)

# We then extend the logic to include countries that only ship oil out via ships. In this case, these countries are Nigeria and the USA.

ships_list=[&#39;Ship A&#39;,&#39;Ship B&#39;,&#39;Ship C&#39;]
ships_capacity={&#39;Ship A&#39;:[0.084,40/1000000],
                &#39;Ship B&#39;:[0.0504,30/1000000],
                &#39;Ship C&#39;:[0.0315,25/1000000]}

number_of_ship=m2.addVars(countries_list_ships,ships_list,lb=0,vtype=GRB.INTEGER,name=&quot;number_of_ships&quot;)

for c in countries_list_ships:
    m2.addConstr(quantity[c]&lt;=quicksum(number_of_ship[c,s]*ships_capacity[s][0] for s in ships_list))


m2.setObjective(
     quicksum(auxiliary[c,p]*piecewise_price[c,p][0] for c in countries_list_pipes for p in pieces_list) +
     quicksum(quantity[c]*cost[c] for c in countries_list_ships) +
     quicksum(number_of_ship[c,s]*ships_capacity[s][1]*days_ship[c] for c in countries_list_ships for s in ships_list), GRB.MINIMIZE)</code></pre>
<p>Running our more realistic model with a piecewise function for the countries using pipelines and adding a variable cost to the countries using ships, it returned that everything should be allocated to Russia, with total costs amounting to $0.408 billion. However, importing everything from one country – and particularly Russia, given the political situation - is far from realistic. For this reason, we built a prototype such that one can input given constraints into the model. For example, one constraint could be to set the lower bound for imports from the US to be at least 3 billion gallons.</p>
<p>This is one example where we added realistic constraints:
<img src="../../../../../../../../img/blogs/results.png" /><!-- --></p>
<p><strong>Russia or US Imports</strong>
We have added an additional constraint to ensure that if we import oil from the USA, we cannot import from Russia, and vice versa, using the big-M method. The constraint is enforced by setting the quantity of oil imported from one country to be less than or equal to the big-M value times the binary variable representing the decision to import from that country and setting the sum of the two binary variables to be less than or equal to 1. By doing this, we ensure that only one of the binary variables can take a value of 1, meaning that we can only import oil from one of the two countries. This constraint helps us explore alternative sources of oil and consider the impact of potential restrictions on oil imports from these countries, considering the maximum production capacity and transportation costs from different countries.</p>
<p><strong>Predicting Future Demand</strong>
Finally, we determine the UK’s budget allocation for the upcoming year for crude oil. We first simulate demand for the next year using the Poisson distribution, take the 2021 demand as the lambda and 13.6 as the mean. We use the same constraints as under the “Russia or US imports” model. We then found the 0th, 25th, 50th, 75th and 100th percentile demands, and ran the whole model again for these 5 demands to output the range of possible costs of oil to the U.K. This is relevant for future budgeting but also for deciding on where to import oil from. For example, if the expected demand is higher, the UK might opt for imports from Libya because</p>
<p><strong>Prototype</strong>
We built a Graphical User Interface that is connected to our Gurobi Solver This interface allows users to input their own constraints, choose whether they want the model to optimize using the simple (not including transportation costs) or complex model, and whether the UK is sanctioning Russia. This is how the prototype looks like:
<img src="../../../../../../../../img/blogs/prototype.png" /><!-- --></p>
<p>If you have a Gurobi license you can download the Python script we used in this analysis <a href="/Users/wybeharms/Desktop/LBS/Decision%20Analytics%20and%20Modeling/group_project/decision_analytics_group_13/Group_13_final_project_old.py">here</a> and run the solver yourself!</p>
</div>
